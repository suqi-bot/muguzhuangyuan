import{d as F,u as P,a as M,b as c,r as S,o as T,e as B,f as m,g,i as e,s as i,h as u,x as p,t as _,N as k,w as h,m as v,v as f,K as L,l as x,D as R,_ as j}from"./index-BfWrQTtX.js";import{r as b}from"./request-DzKJqaQU.js";const O={class:"edit-profile-page"},z={class:"navbar"},A={class:"nav-container"},G={class:"nav-menu"},q={class:"nav-buttons"},J={class:"user-welcome"},K={class:"edit-profile-main"},W={class:"edit-profile-container"},H={class:"edit-profile-content"},Q={class:"edit-profile-card"},X={class:"form-section"},Y={class:"form-grid"},Z={class:"form-group"},$={class:"form-group"},ss={class:"form-group"},es={class:"form-group"},ts={class:"form-section"},os={class:"avatar-section"},as={class:"current-avatar"},ls=["src"],rs={class:"avatar-upload"},ns={class:"upload-options"},is={class:"upload-method"},ds={key:0,class:"upload-progress"},us={class:"progress-bar"},ps={class:"progress-text"},vs={class:"upload-method"},fs={class:"form-group"},cs={class:"form-actions"},ms=["disabled"],gs={key:0,class:"loading-spinner"},_s=F({__name:"EditProfileView",setup(hs){const y=P(),l=M(),d=c(!1),n=c(0),w=c(),o=S({realName:"",phone:"",gender:"",idCard:"",avatar:""}),N=async()=>{try{const t=await b.get("/h/user/getUserInfo");if(t.code===200||t.code==="200")Object.assign(o,t.data);else throw new Error(t.msg||"获取用户信息失败")}catch(t){console.error("获取用户信息失败:",t),l.user&&Object.assign(o,{realName:l.user.realName||"",phone:l.user.phone||"",gender:l.user.gender||"",idCard:l.user.idCard||"",avatar:l.user.avatar||""})}},U=async()=>{d.value=!0;try{const t=await b.put("/h/user/updateInfo",o);if(t.code===200||t.code==="200")l.user&&Object.assign(l.user,o),alert("个人信息更新成功！"),y.push("/profile");else throw new Error(t.msg||"更新失败")}catch(t){console.error("更新个人信息失败:",t),alert("更新失败，请稍后重试")}finally{d.value=!1}},V=()=>{l.logout(),y.push("/login")},I=()=>{w.value?.click()},D=async t=>{const r=t.target.files?.[0];r&&await C(r)},E=async t=>{const s=t.dataTransfer?.files;s&&s.length>0&&await C(s[0])},C=async t=>{if(!t.type.startsWith("image/")){alert("请选择图片文件");return}if(t.size>5*1024*1024){alert("图片大小不能超过5MB");return}try{n.value=0;const s=new FormData;s.append("file",t);const r=setInterval(()=>{n.value<90&&(n.value+=10)},100),a=await b.post("/files/upload",s,{headers:{"Content-Type":"multipart/form-data"}});if(clearInterval(r),n.value=100,a.code===200||a.code==="200")o.avatar=a.data,setTimeout(()=>{n.value=0},1e3);else throw new Error(a.msg||"上传失败")}catch(s){console.error("头像上传失败:",s),alert("头像上传失败，请稍后重试"),n.value=0}};return T(()=>{N()}),(t,s)=>{const r=B("router-link");return g(),m("div",O,[e("nav",z,[e("div",A,[s[10]||(s[10]=e("div",{class:"logo"},[e("i",{class:"fas fa-seedling"}),i(" 普洱蘑菇庄园 ")],-1)),e("div",G,[u(r,{to:"/",class:"nav-link"},{default:p(()=>s[6]||(s[6]=[i("首页")])),_:1,__:[6]}),u(r,{to:"/ai-rooms",class:"nav-link"},{default:p(()=>s[7]||(s[7]=[i("AI选房")])),_:1,__:[7]}),u(r,{to:"/orders",class:"nav-link"},{default:p(()=>s[8]||(s[8]=[i("订单")])),_:1,__:[8]}),u(r,{to:"/profile",class:"nav-link"},{default:p(()=>s[9]||(s[9]=[i("个人信息")])),_:1,__:[9]})]),e("div",q,[e("span",J,"欢迎，"+_(k(l).user?.name||k(l).user?.email),1),e("button",{onClick:V,class:"btn btn-outline"},"退出")])])]),e("main",K,[e("div",W,[s[24]||(s[24]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"编辑个人信息"),e("p",{class:"page-subtitle"},"更新您的个人资料")],-1)),e("div",H,[e("div",Q,[e("form",{onSubmit:h(U,["prevent"])},[e("div",X,[s[16]||(s[16]=e("h3",null,"基本信息",-1)),e("div",Y,[e("div",Z,[s[11]||(s[11]=e("label",{for:"realName"},"真实姓名",-1)),v(e("input",{type:"text",id:"realName","onUpdate:modelValue":s[0]||(s[0]=a=>o.realName=a),class:"form-input",placeholder:"请输入真实姓名"},null,512),[[f,o.realName]])]),e("div",$,[s[12]||(s[12]=e("label",{for:"phone"},"手机号",-1)),v(e("input",{type:"tel",id:"phone","onUpdate:modelValue":s[1]||(s[1]=a=>o.phone=a),class:"form-input",placeholder:"请输入手机号"},null,512),[[f,o.phone]])]),e("div",ss,[s[14]||(s[14]=e("label",{for:"gender"},"性别",-1)),v(e("select",{id:"gender","onUpdate:modelValue":s[2]||(s[2]=a=>o.gender=a),class:"form-select"},s[13]||(s[13]=[e("option",{value:""},"请选择性别",-1),e("option",{value:"男"},"男",-1),e("option",{value:"女"},"女",-1)]),512),[[L,o.gender]])]),e("div",es,[s[15]||(s[15]=e("label",{for:"idCard"},"身份证号",-1)),v(e("input",{type:"text",id:"idCard","onUpdate:modelValue":s[3]||(s[3]=a=>o.idCard=a),class:"form-input",placeholder:"请输入身份证号"},null,512),[[f,o.idCard]])])])]),e("div",ts,[s[22]||(s[22]=e("h3",null,"头像设置",-1)),e("div",os,[e("div",as,[e("img",{src:o.avatar||"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e",alt:"当前头像",class:"avatar-preview"},null,8,ls)]),e("div",rs,[e("div",ns,[e("div",is,[s[18]||(s[18]=e("h4",null,"方式一：上传图片文件",-1)),e("div",{class:"file-upload-area",onClick:I,onDragover:s[4]||(s[4]=h(()=>{},["prevent"])),onDrop:h(E,["prevent"])},[e("input",{ref_key:"fileInput",ref:w,type:"file",accept:"image/*",onChange:D,style:{display:"none"}},null,544),s[17]||(s[17]=e("div",{class:"upload-content"},[e("i",{class:"fas fa-cloud-upload-alt"}),e("p",null,"点击上传或拖拽图片到此处"),e("p",{class:"upload-hint"},"支持 JPG、PNG 格式，建议尺寸 200x200px")],-1))],32),n.value>0?(g(),m("div",ds,[e("div",us,[e("div",{class:"progress-fill",style:R({width:n.value+"%"})},null,4)]),e("span",ps,_(n.value)+"%",1)])):x("",!0)]),s[21]||(s[21]=e("div",{class:"upload-divider"},"或",-1)),e("div",vs,[s[19]||(s[19]=e("h4",null,"方式二：输入图片URL",-1)),e("div",fs,[v(e("input",{type:"url","onUpdate:modelValue":s[5]||(s[5]=a=>o.avatar=a),class:"form-input",placeholder:"请输入头像图片URL"},null,512),[[f,o.avatar]])]),s[20]||(s[20]=e("p",{class:"help-text"},"请输入有效的图片URL地址",-1))])])])])]),e("div",cs,[u(r,{to:"/profile",class:"btn btn-outline"},{default:p(()=>s[23]||(s[23]=[i("取消")])),_:1,__:[23]}),e("button",{type:"submit",class:"btn btn-primary",disabled:d.value},[d.value?(g(),m("span",gs)):x("",!0),i(" "+_(d.value?"保存中...":"保存更改"),1)],8,ms)])],32)])])])])])}}}),ws=j(_s,[["__scopeId","data-v-eeab665b"]]);export{ws as default};
