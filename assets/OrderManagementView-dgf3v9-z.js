import{d as A,b as p,r as O,o as E,f as i,g as c,i as s,l as v,s as b,F as M,k as V,m as T,M as G,v as j,G as H,t as o,w as J,p as C,_ as Q}from"./index-vYzfv9NW.js";import{r as m}from"./request-DzKJqaQU.js";const R={class:"order-management fade-in"},W={class:"toolbar"},X={class:"toolbar-left"},Y={class:"filter-tabs"},Z=["onClick"],ss={class:"toolbar-right"},ts={class:"search-box"},es={class:"stats-cards"},as={class:"stat-card"},os={class:"stat-content"},ns={class:"stat-card"},ls={class:"stat-content"},is={class:"stat-card"},cs={class:"stat-content"},rs={class:"stat-card"},ds={class:"stat-content"},us={class:"order-list"},ps={class:"list-header"},vs={class:"list-controls"},fs={class:"total-count"},bs={key:0,class:"loading"},ms={key:1,class:"order-table"},hs={class:"order-info"},_s={class:"order-basic"},gs={class:"order-date"},ys={class:"order-days"},ks={class:"customer-info"},Cs={class:"customer-basic"},ws={class:"customer-phone"},$s={class:"customer-id"},xs={class:"room-info"},Ds={class:"room-basic"},Ss={class:"room-id"},Os={class:"date-info"},Ms={class:"date-range"},Vs={class:"check-in"},Ts={class:"check-out"},zs={class:"amount-info"},Ns={class:"amount-details"},Bs={class:"total-amount"},Fs={class:"actions"},Is={class:"action-buttons"},Ks=["onClick"],Ls=["onClick"],Ps=["onClick"],Us=["onClick"],qs=["onClick"],As={key:0,class:"empty-state"},Es={key:2,class:"pagination"},Gs=["disabled"],js={class:"page-info"},Hs=["disabled"],Js=A({__name:"OrderManagementView",setup(Qs){const n={success:(e,t)=>{console.log(`✅ ${t||"成功"}: ${e}`),alert(`✅ ${e}`)},error:(e,t)=>{console.error(`❌ ${t||"错误"}: ${e}`),alert(`❌ ${e}`)},warning:(e,t)=>{console.warn(`⚠️ ${t||"警告"}: ${e}`),alert(`⚠️ ${e}`)},info:(e,t)=>{console.info(`ℹ️ ${t||"信息"}: ${e}`),alert(`ℹ️ ${e}`)}},g=p(!1),d=p([]),h=p(""),_=p(""),w=p(""),y=p(!1),$=p(null),z=[{label:"全部",value:""},{label:"预订",value:"预订"},{label:"入住",value:"入住"},{label:"完成",value:"完成"},{label:"取消",value:"取消"}],l=O({current:1,size:10,total:0,pages:0}),u=O({total:0,pending:0,confirmed:0,completed:0}),r=async()=>{g.value=!0;try{const e=await m.get("/h/order",{params:{pageNum:l.current,pageSize:l.size,search:h.value,searchType:_.value}});e.code===200||e.code==="200"?(d.value=e.data?.records||[],l.total=e.data?.total||0,l.pages=e.data?.pages||0,N(),n.success("订单数据加载成功","数据加载")):n.error(e.message||e.msg||"获取订单列表失败","加载失败")}catch(e){console.error("获取订单列表失败:",e),n.error("网络错误，请稍后重试","加载失败")}finally{g.value=!1}},N=()=>{u.total=d.value.length,u.pending=d.value.filter(e=>e.state==="预订").length,u.confirmed=d.value.filter(e=>e.state==="入住").length,u.completed=d.value.filter(e=>e.state==="完成").length},B=e=>{w.value=e,h.value=e,_.value="state",l.current=1,r()},x=()=>{l.current=1,r()},F=()=>{r()},D=e=>{l.current=e,r()},I=e=>{$.value=e,y.value=!0},K=async e=>{try{const t={...e,state:"入住"},a=await m.put("/h/order",t);a.code===200||a.code==="200"?(n.success("订单确认成功","操作成功"),await r()):n.error(a.message||a.msg||"确认订单失败","操作失败")}catch(t){console.error("确认订单失败:",t),n.error("网络错误，请稍后重试","操作失败")}},L=async e=>{try{const t=await m.post("/h/order/pay",e.id);t.code===200||t.code==="200"?(n.success("订单支付成功","操作成功"),await r()):n.error(t.message||t.msg||"支付失败","操作失败")}catch(t){console.error("标记支付失败:",t),n.error("网络错误，请稍后重试","操作失败")}},P=async e=>{try{const t=await m.post("/h/order/checkout",e);t.code===200||t.code==="200"?(n.success("退房成功","操作成功"),await r()):n.error(t.message||t.msg||"退房失败","操作失败")}catch(t){console.error("退房失败:",t),n.error("网络错误，请稍后重试","操作失败")}},U=async e=>{if(confirm(`确定要删除订单 #${e.id} 吗？`))try{const t=await m.delete(`/h/order/del/${e.id}`);t.code===200||t.code==="200"?(n.success("订单删除成功","删除成功"),await r()):n.error(t.message||t.msg||"删除失败","操作失败")}catch(t){console.error("删除订单失败:",t),n.error("网络错误，请稍后重试","删除失败")}},S=()=>{y.value=!1,$.value=null},q=e=>{switch(e){case"预订":return"pending";case"入住":return"confirmed";case"完成":return"completed";case"取消":return"cancelled";default:return"unknown"}},k=e=>e?new Date(e).toLocaleDateString("zh-CN"):"-";return E(()=>{r()}),(e,t)=>(c(),i("div",R,[t[30]||(t[30]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},[s("i",{class:"fas fa-clipboard-list"}),b(" 订单管理 ")]),s("p",{class:"page-description"},"管理普洱蘑菇庄园民宿的所有订单信息")],-1)),s("div",W,[s("div",X,[s("button",{onClick:F,class:"btn btn-secondary"},t[5]||(t[5]=[s("i",{class:"fas fa-sync-alt"},null,-1),b(" 刷新 ")])),s("div",Y,[(c(),i(M,null,V(z,a=>s("button",{key:a.value,onClick:f=>B(a.value),class:C(["tab-btn",{active:w.value===a.value}])},o(a.label),11,Z)),64))])]),s("div",ss,[s("div",ts,[T(s("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),class:"search-type"},t[6]||(t[6]=[s("option",{value:""},"全部",-1),s("option",{value:"username"},"用户名",-1),s("option",{value:"phone"},"手机号",-1),s("option",{value:"roomCode"},"房间号",-1)]),512),[[G,_.value]]),T(s("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>h.value=a),onKeyup:H(x,["enter"]),type:"text",placeholder:"搜索订单...",class:"search-input"},null,544),[[j,h.value]]),s("button",{onClick:x,class:"btn btn-search"},t[7]||(t[7]=[s("i",{class:"fas fa-search"},null,-1)]))])])]),s("div",es,[s("div",as,[t[9]||(t[9]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-clipboard-list"})],-1)),s("div",os,[s("h3",null,o(u.total),1),t[8]||(t[8]=s("p",null,"总订单数",-1))])]),s("div",ns,[t[11]||(t[11]=s("div",{class:"stat-icon pending"},[s("i",{class:"fas fa-clock"})],-1)),s("div",ls,[s("h3",null,o(u.pending),1),t[10]||(t[10]=s("p",null,"待处理",-1))])]),s("div",is,[t[13]||(t[13]=s("div",{class:"stat-icon confirmed"},[s("i",{class:"fas fa-check-circle"})],-1)),s("div",cs,[s("h3",null,o(u.confirmed),1),t[12]||(t[12]=s("p",null,"已确认",-1))])]),s("div",rs,[t[15]||(t[15]=s("div",{class:"stat-icon completed"},[s("i",{class:"fas fa-star"})],-1)),s("div",ds,[s("h3",null,o(u.completed),1),t[14]||(t[14]=s("p",null,"已完成",-1))])])]),s("div",us,[s("div",ps,[t[16]||(t[16]=s("h2",null,"订单列表",-1)),s("div",vs,[s("span",fs,"共 "+o(l.total)+" 个订单",1)])]),g.value?(c(),i("div",bs,t[17]||(t[17]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),b(" 加载中... ")]))):(c(),i("div",ms,[s("table",null,[t[23]||(t[23]=s("thead",null,[s("tr",null,[s("th",null,"订单信息"),s("th",null,"客户信息"),s("th",null,"房间信息"),s("th",null,"入住时间"),s("th",null,"订单金额"),s("th",null,"状态"),s("th",null,"操作")])],-1)),s("tbody",null,[(c(!0),i(M,null,V(d.value,a=>(c(),i("tr",{key:a.id,class:"order-row"},[s("td",hs,[s("div",_s,[s("h4",null,"订单 #"+o(a.id),1),s("p",gs,o(k(a.createTime)),1),s("p",ys,o(a.days)+" 晚",1)])]),s("td",ks,[s("div",Cs,[s("h4",null,o(a.username),1),s("p",ws,o(a.phone),1),s("p",$s,o(a.idCard),1)])]),s("td",xs,[s("div",Ds,[s("h4",null,"房间 "+o(a.roomCode),1),s("p",Ss,"ID: "+o(a.roomId),1)])]),s("td",Os,[s("div",Ms,[s("p",Vs,"入住: "+o(a.startDate?k(a.startDate):"未设置"),1),s("p",Ts,"离店: "+o(a.endDate?k(a.endDate):"未设置"),1)])]),s("td",zs,[s("div",Ns,[s("h4",Bs,"¥"+o(a.total),1),s("p",{class:C(["pay-status",a.payState===1?"paid":"unpaid"])},o(a.payState===1?"已支付":"未支付"),3)])]),s("td",null,[s("span",{class:C(["status-badge",q(a.state||"")])},o(a.state),3)]),s("td",Fs,[s("div",Is,[s("button",{onClick:f=>I(a),class:"btn btn-sm btn-info action-btn",title:"查看订单详情","data-tooltip":"查看详情"},t[18]||(t[18]=[s("i",{class:"fas fa-eye"},null,-1),s("span",{class:"btn-text"},"查看",-1)]),8,Ks),a.state==="预订"?(c(),i("button",{key:0,onClick:f=>K(a),class:"btn btn-sm btn-success action-btn",title:"确认订单，客户可入住","data-tooltip":"确认入住"},t[19]||(t[19]=[s("i",{class:"fas fa-check"},null,-1),s("span",{class:"btn-text"},"确认",-1)]),8,Ls)):v("",!0),a.payState===0?(c(),i("button",{key:1,onClick:f=>L(a),class:"btn btn-sm btn-warning action-btn",title:"标记为已支付","data-tooltip":"标记支付"},t[20]||(t[20]=[s("i",{class:"fas fa-credit-card"},null,-1),s("span",{class:"btn-text"},"支付",-1)]),8,Ps)):v("",!0),a.state==="入住"?(c(),i("button",{key:2,onClick:f=>P(a),class:"btn btn-sm btn-primary action-btn",title:"办理退房手续","data-tooltip":"办理退房"},t[21]||(t[21]=[s("i",{class:"fas fa-sign-out-alt"},null,-1),s("span",{class:"btn-text"},"退房",-1)]),8,Us)):v("",!0),s("button",{onClick:f=>U(a),class:"btn btn-sm btn-danger action-btn",title:"删除订单（不可恢复）","data-tooltip":"删除订单"},t[22]||(t[22]=[s("i",{class:"fas fa-trash"},null,-1),s("span",{class:"btn-text"},"删除",-1)]),8,qs)])])]))),128))])]),d.value.length===0?(c(),i("div",As,t[24]||(t[24]=[s("i",{class:"fas fa-clipboard-list"},null,-1),s("h3",null,"暂无订单数据",-1),s("p",null,"当前筛选条件下没有找到订单",-1)]))):v("",!0)])),d.value.length>0?(c(),i("div",Es,[s("button",{onClick:t[2]||(t[2]=a=>D(l.current-1)),disabled:l.current<=1,class:"btn btn-secondary"},t[25]||(t[25]=[s("i",{class:"fas fa-chevron-left"},null,-1),b(" 上一页 ")]),8,Gs),s("span",js," 第 "+o(l.current)+" 页，共 "+o(l.pages)+" 页 ",1),s("button",{onClick:t[3]||(t[3]=a=>D(l.current+1)),disabled:l.current>=l.pages,class:"btn btn-secondary"},t[26]||(t[26]=[b(" 下一页 "),s("i",{class:"fas fa-chevron-right"},null,-1)]),8,Hs)])):v("",!0)]),y.value?(c(),i("div",{key:0,class:"modal-overlay",onClick:S},[s("div",{class:"modal modal-large",onClick:t[4]||(t[4]=J(()=>{},["stop"]))},[s("div",{class:"modal-header"},[t[28]||(t[28]=s("h3",null,"订单详情",-1)),s("button",{onClick:S,class:"close-btn"},t[27]||(t[27]=[s("i",{class:"fas fa-times"},null,-1)]))]),t[29]||(t[29]=s("div",{class:"modal-body"},[s("p",null,"订单详情功能开发中...")],-1))])])):v("",!0)]))}}),Xs=Q(Js,[["__scopeId","data-v-e49a997d"]]);export{Xs as default};
