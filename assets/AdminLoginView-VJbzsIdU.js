import{d as b,u as w,a as _,r as h,b as c,e as y,f as p,g as m,i as e,s as d,h as k,x,j as V,w as C,m as u,v as N,n as q,p as A,q as D,l as L,t as R,_ as S}from"./index-DFO3eZqt.js";import{r as I}from"./request-DzKJqaQU.js";const M="/muguzhuangyuan/assets/swiper01-CPRDoL6I.JPG",T={class:"admin-login-page"},U={class:"navbar"},B={class:"nav-container"},P={class:"nav-actions"},$={class:"main-content"},z={class:"login-container"},J={class:"login-form-wrapper"},j={class:"form-group"},E={class:"input-wrapper"},F={class:"form-group"},G={class:"input-wrapper"},O=["type"],H={class:"form-group"},K={class:"checkbox-wrapper"},Q=["disabled"],W={key:0,class:"loading-spinner"},X=b({__name:"AdminLoginView",setup(Y){const f=w(),l=_(),t=h({username:"",password:"",remember:!1}),i=c(!1),r=c(!1),g=async()=>{if(!t.username||!t.password){alert("请填写完整的登录信息");return}console.log("开始管理员登录:",{username:t.username,password:t.password}),r.value=!0;try{console.log("发送登录请求到:","/sys/user/login");const o=await I.post("/sys/user/login",{username:t.username,password:t.password});if(console.log("管理员登录响应:",o),console.log("响应类型:",typeof o),console.log("响应内容:",JSON.stringify(o,null,2)),o.code===200||o.code==="200"){const s=o.data,a=s.user,n=s.tokenInfo;if(console.log("用户信息:",a),console.log("Token信息:",n),!a||!n){alert("登录响应数据异常，请重试");return}l.login(a.email||a.username,n.tokenValue,a.realName,a.phonenumber,a.gender,a.idCard,a.avatar,void 0,a.username,a.realName),l.setUserRole("admin"),console.log("登录后的认证状态:",{isAuthenticated:l.isAuthenticated,userRole:l.userRole,user:l.user}),alert("管理员登录成功！即将跳转到管理后台..."),setTimeout(()=>{console.log("准备跳转到 /admin"),f.push("/admin").then(()=>{console.log("跳转成功")}).catch(v=>{console.error("跳转失败:",v),window.location.href="/admin"})},500)}else alert(o.msg||"登录失败，请检查账号密码")}catch(o){if(console.error("管理员登录失败:",o),console.error("错误详情:",{message:o.message,response:o.response,status:o.response?.status,data:o.response?.data}),o.response){const s=o.response.status,a=o.response.data;alert(s===500?"服务器内部错误，请稍后重试":s===404?"登录接口不存在，请检查后端服务":s===401?"用户名或密码错误":`登录失败: ${a?.msg||o.message}`)}else o.request?(console.error("网络请求失败:",o.request),alert("网络连接失败，请检查网络或后端服务是否启动")):alert(`登录失败: ${o.message}`)}finally{r.value=!1}};return(o,s)=>{const a=y("router-link");return m(),p("div",T,[e("nav",U,[e("div",B,[s[5]||(s[5]=e("div",{class:"logo"},[e("i",{class:"fas fa-seedling"}),d(" 普洱蘑菇庄园民宿 - 管理后台 ")],-1)),e("div",P,[k(a,{to:"/",class:"nav-link"},{default:x(()=>s[4]||(s[4]=[d("返回首页")])),_:1,__:[4]})])])]),e("main",$,[s[12]||(s[12]=e("div",{class:"login-background"},[e("img",{src:M,alt:"管理后台背景"}),e("div",{class:"background-overlay"})],-1)),e("div",z,[e("div",J,[s[11]||(s[11]=V('<div class="login-header" data-v-df8d821b><div class="admin-icon" data-v-df8d821b><i class="fas fa-user-shield" data-v-df8d821b></i></div><h1 class="login-title" data-v-df8d821b>管理员登录</h1><p class="login-subtitle" data-v-df8d821b>普洱蘑菇庄园民宿管理系统</p></div>',1)),e("form",{onSubmit:C(g,["prevent"]),class:"login-form"},[e("div",j,[s[7]||(s[7]=e("label",{for:"username",class:"form-label"},"管理员账号",-1)),e("div",E,[s[6]||(s[6]=e("i",{class:"fas fa-user-shield input-icon"},null,-1)),u(e("input",{type:"text",id:"username","onUpdate:modelValue":s[0]||(s[0]=n=>t.username=n),class:"form-input",placeholder:"请输入管理员账号",required:""},null,512),[[N,t.username]])])]),e("div",F,[s[9]||(s[9]=e("label",{for:"password",class:"form-label"},"密码",-1)),e("div",G,[s[8]||(s[8]=e("i",{class:"fas fa-lock input-icon"},null,-1)),u(e("input",{type:i.value?"text":"password",id:"password","onUpdate:modelValue":s[1]||(s[1]=n=>t.password=n),class:"form-input",placeholder:"请输入密码",required:""},null,8,O),[[q,t.password]]),e("button",{type:"button",class:"password-toggle",onClick:s[2]||(s[2]=n=>i.value=!i.value)},[e("i",{class:A(i.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),e("div",H,[e("label",K,[u(e("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=n=>t.remember=n),class:"checkbox-input"},null,512),[[D,t.remember]]),s[10]||(s[10]=e("span",{class:"checkbox-label"},"记住登录状态",-1))])]),e("button",{type:"submit",class:"login-btn",disabled:r.value},[r.value?(m(),p("span",W)):L("",!0),d(" "+R(r.value?"登录中...":"管理员登录"),1)],8,Q)],32)])])])])}}}),es=S(X,[["__scopeId","data-v-df8d821b"]]);export{es as default};
