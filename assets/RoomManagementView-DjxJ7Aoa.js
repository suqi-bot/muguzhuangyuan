import{d as J,W as Q,b as v,r as $,o as X,f as p,g as f,i as t,l as C,s as y,m as u,M as E,v as c,G as Y,t as n,F as Z,k as tt,w as N,j as st,p as q,_ as et}from"./index-vYzfv9NW.js";import{r as _}from"./request-DzKJqaQU.js";const at={class:"room-management fade-in"},lt={class:"toolbar"},nt={class:"toolbar-left"},ot={class:"toolbar-right"},it={class:"search-box"},dt={class:"stats-cards"},rt={class:"stat-card slide-in-left",style:{"animation-delay":"0.1s"}},ut={class:"stat-content"},ct=["data-target"],pt={class:"stat-card slide-in-left",style:{"animation-delay":"0.2s"}},ft={class:"stat-content"},vt=["data-target"],mt={class:"stat-card slide-in-left",style:{"animation-delay":"0.3s"}},bt={class:"stat-content"},gt=["data-target"],yt={class:"stat-card slide-in-left",style:{"animation-delay":"0.4s"}},kt={class:"stat-content"},wt=["data-target"],ht={class:"room-list"},xt={class:"list-header"},Ct={class:"list-controls"},_t={class:"total-count"},$t={key:0,class:"loading"},Vt={key:1,class:"room-table"},Mt={class:"room-info"},Ut={class:"room-basic"},St={class:"room-code"},Tt={class:"room-address"},Rt={class:"category-tag"},Nt={class:"price"},qt={class:"price-amount"},Dt={class:"actions"},Lt={class:"action-buttons"},jt=["onClick"],zt=["onClick"],Et=["onClick","title","data-tooltip"],Ft={class:"btn-text"},Bt=["onClick"],Kt={key:0,class:"empty-state"},Ot={key:2,class:"pagination"},Ht=["disabled"],At={class:"page-info"},Gt=["disabled"],It={class:"modal-header"},Pt={class:"modal-body"},Wt={class:"form-row"},Jt={class:"form-group"},Qt={class:"form-group"},Xt={class:"form-row"},Yt={class:"form-group"},Zt={class:"form-group"},ts={class:"form-row"},ss={class:"form-group"},es={class:"form-group"},as={class:"form-group"},ls={class:"form-group"},ns={class:"form-group"},os={class:"form-group"},is={class:"form-group"},ds={class:"form-actions"},rs=["disabled"],us={key:0,class:"fas fa-spinner fa-spin"},cs=J({__name:"RoomManagementView",setup(ps){const o=Q(),V=v(!1),m=v([]),M=v(""),U=v(""),b=v(!1),S=v(!1),T=v(!1),R=v(null),h=v(!1),l=$({id:null,name:"",code:"",category:"",price:"",city:"",seat:"",address:"",device:"",banner:"",describe:"",remark:"",status:0,state:"空闲",weight:0}),i=$({current:1,size:10,total:0,pages:0}),x=$({total:0,available:0,occupied:0,reserved:0}),g=$({total:0,available:0,occupied:0,reserved:0}),k=async()=>{V.value=!0;try{const e=await _.get("/h/room",{params:{pageNum:i.current,pageSize:i.size,search:M.value,searchType:U.value}});e.code===200||e.code==="200"?(m.value=e.data?.records||[],i.total=e.data?.total||0,i.pages=e.data?.pages||0,L(),o.success("房间数据加载成功","数据加载")):o.error(e.message||e.msg||"获取房间列表失败","加载失败")}catch{o.error("网络错误，请稍后重试","加载失败")}finally{V.value=!1}},D=(e,s,a)=>{const d=Math.ceil((e-s)/20);s<e?(g[a]=s+d,setTimeout(()=>D(e,s+d,a),50)):g[a]=e},L=()=>{const e={total:m.value.length,available:m.value.filter(s=>s.state==="空闲").length,occupied:m.value.filter(s=>s.state==="入住").length,reserved:m.value.filter(s=>s.state==="预订").length};Object.assign(x,e),Object.keys(e).forEach(s=>{const a=s;D(e[a],g[a],a)})},j=()=>{i.current=1,k()},F=()=>{k()},z=e=>{i.current=e,k()},B=e=>{R.value=e,T.value=!0},K=e=>{R.value=e,Object.assign(l,{id:e.id,name:e.name||"",code:e.code||"",category:e.category||"",price:e.price||"",city:e.city||"",seat:e.seat||"",address:e.address||"",device:e.device||"",banner:e.banner||"",describe:e.describe||"",remark:e.remark||"",status:e.status||0,state:e.state||"空闲",weight:e.weight||0}),S.value=!0},O=async e=>{const s=e.status===0?"启用":"禁用",a=`确定要${s}房间"${e.name}"吗？

${s==="禁用"?"⚠️ 禁用后该房间将无法被预订":"✅ 启用后该房间可正常预订"}`;if(await o.confirm({title:`确认${s}房间`,message:a,confirmText:`确认${s}`,cancelText:"取消"}))try{o.info(`正在${s}房间...`,"处理中");const r=await _.put("/h/room/status",e);r.code===200||r.code==="200"?(e.status=e.status===0?1:0,o.success(`房间"${e.name}"已${s}`,`${s}成功`),L()):o.error(r.message||r.msg||`${s}失败，请稍后重试`,"操作失败")}catch(r){console.error("切换房间状态失败:",r),o.error("网络连接异常，请检查网络后重试","操作失败")}},H=async e=>{const s=`房间信息：
• 房间名称：${e.name}
• 房间编号：${e.roomNumber||"未设置"}
• 房间类型：${e.category||"未设置"}

此操作不可恢复，确定要删除吗？`;if(await o.confirm({title:"⚠️ 确认删除操作",message:s,icon:"fas fa-exclamation-triangle",confirmText:"确认删除",cancelText:"取消"})){const d=event?.target;d&&(d.innerHTML='<i class="fas fa-spinner fa-spin"></i> 删除中...',d.style.pointerEvents="none");try{const r=await _.delete(`/h/room/${e.id}`);r.code===200||r.code==="200"?(o.success(`房间"${e.name}"已成功删除`,"删除成功"),await k()):o.error(r.message||r.msg||"删除失败，请稍后重试","操作失败")}catch(r){console.error("删除房间失败:",r),o.error("网络连接异常，请检查网络后重试","删除失败")}finally{d&&(d.innerHTML='<i class="fas fa-trash"></i> <span class="btn-text">删除</span>',d.style.pointerEvents="auto")}}},A=()=>{Object.assign(l,{id:null,name:"",code:"",category:"",price:"",city:"",seat:"",address:"",device:"",banner:"",describe:"",remark:"",status:0,state:"空闲",weight:0})},w=()=>{b.value=!1,S.value=!1,T.value=!1,R.value=null,A()},G=async()=>{h.value=!0;try{let e;b.value?e=await _.post("/h/room",l):e=await _.put("/h/room",l),e.code===200||e.code==="200"?(o.success(b.value?"房间添加成功":"房间更新成功","操作成功"),w(),await k()):o.error(e.message||e.msg||"操作失败","提交失败")}catch(e){console.error("提交表单失败:",e),o.error("网络错误，请稍后重试","提交失败")}finally{h.value=!1}},I=e=>{switch(e){case"空闲":return"available";case"入住":return"occupied";case"预订":return"reserved";default:return"unknown"}},P=e=>e||"未知",W=e=>e?new Date(e).toLocaleDateString("zh-CN"):"-";return X(()=>{k()}),(e,s)=>(f(),p("div",at,[s[56]||(s[56]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},[t("i",{class:"fas fa-bed"}),y(" 房间管理 ")]),t("p",{class:"page-description"},"管理普洱蘑菇庄园民宿的所有房间信息")],-1)),t("div",lt,[t("div",nt,[t("button",{onClick:s[0]||(s[0]=a=>b.value=!0),class:"btn btn-primary"},s[18]||(s[18]=[t("i",{class:"fas fa-plus"},null,-1),y(" 添加房间 ")])),t("button",{onClick:F,class:"btn btn-secondary"},s[19]||(s[19]=[t("i",{class:"fas fa-sync-alt"},null,-1),y(" 刷新 ")]))]),t("div",ot,[t("div",it,[u(t("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>U.value=a),class:"search-type"},s[20]||(s[20]=[t("option",{value:""},"全部",-1),t("option",{value:"name"},"房间名称",-1),t("option",{value:"category"},"房间类型",-1),t("option",{value:"city"},"城市",-1)]),512),[[E,U.value]]),u(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>M.value=a),onKeyup:Y(j,["enter"]),type:"text",placeholder:"搜索房间...",class:"search-input"},null,544),[[c,M.value]]),t("button",{onClick:j,class:"btn btn-search"},s[21]||(s[21]=[t("i",{class:"fas fa-search"},null,-1)]))])])]),t("div",dt,[t("div",rt,[s[23]||(s[23]=t("div",{class:"stat-icon"},[t("i",{class:"fas fa-bed"})],-1)),t("div",ut,[t("h3",{class:"stat-number","data-target":x.total},n(g.total),9,ct),s[22]||(s[22]=t("p",null,"总房间数",-1))])]),t("div",pt,[s[25]||(s[25]=t("div",{class:"stat-icon available"},[t("i",{class:"fas fa-check-circle"})],-1)),t("div",ft,[t("h3",{class:"stat-number","data-target":x.available},n(g.available),9,vt),s[24]||(s[24]=t("p",null,"空闲房间",-1))])]),t("div",mt,[s[27]||(s[27]=t("div",{class:"stat-icon occupied"},[t("i",{class:"fas fa-user"})],-1)),t("div",bt,[t("h3",{class:"stat-number","data-target":x.occupied},n(g.occupied),9,gt),s[26]||(s[26]=t("p",null,"已入住",-1))])]),t("div",yt,[s[29]||(s[29]=t("div",{class:"stat-icon reserved"},[t("i",{class:"fas fa-calendar-check"})],-1)),t("div",kt,[t("h3",{class:"stat-number","data-target":x.reserved},n(g.reserved),9,wt),s[28]||(s[28]=t("p",null,"已预订",-1))])])]),t("div",ht,[t("div",xt,[s[30]||(s[30]=t("h2",null,"房间列表",-1)),t("div",Ct,[t("span",_t,"共 "+n(i.total)+" 间房间",1)])]),V.value?(f(),p("div",$t,s[31]||(s[31]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1),y(" 加载中... ")]))):(f(),p("div",Vt,[t("table",null,[s[36]||(s[36]=t("thead",null,[t("tr",null,[t("th",null,"房间信息"),t("th",null,"类型"),t("th",null,"价格"),t("th",null,"状态"),t("th",null,"城市"),t("th",null,"创建时间"),t("th",null,"操作")])],-1)),t("tbody",null,[(f(!0),p(Z,null,tt(m.value,a=>(f(),p("tr",{key:a.id,class:"room-row"},[t("td",Mt,[t("div",Ut,[t("h4",null,n(a.name),1),t("p",St,"房间号: "+n(a.code),1),t("p",Tt,n(a.address),1)])]),t("td",null,[t("span",Rt,n(a.category),1)]),t("td",Nt,[t("span",qt,"¥"+n(a.price),1),s[32]||(s[32]=t("span",{class:"price-unit"},"/晚",-1))]),t("td",null,[t("span",{class:q(["status-badge",I(a.state)])},n(P(a.state)),3)]),t("td",null,n(a.city),1),t("td",null,n(W(a.createTime)),1),t("td",Dt,[t("div",Lt,[t("button",{onClick:d=>B(a),class:"btn btn-sm btn-info action-btn",title:"查看房间详情","data-tooltip":"查看详情"},s[33]||(s[33]=[t("i",{class:"fas fa-eye"},null,-1),t("span",{class:"btn-text"},"查看",-1)]),8,jt),t("button",{onClick:d=>K(a),class:"btn btn-sm btn-warning action-btn",title:"编辑房间信息","data-tooltip":"编辑房间"},s[34]||(s[34]=[t("i",{class:"fas fa-edit"},null,-1),t("span",{class:"btn-text"},"编辑",-1)]),8,zt),t("button",{onClick:d=>O(a),class:q(["btn btn-sm action-btn",a.status===0?"btn-danger":"btn-success"]),title:a.status===0?"启用房间":"禁用房间","data-tooltip":a.status===0?"启用":"禁用"},[t("i",{class:q(a.status===0?"fas fa-ban":"fas fa-check")},null,2),t("span",Ft,n(a.status===0?"启用":"禁用"),1)],10,Et),t("button",{onClick:d=>H(a),class:"btn btn-sm btn-danger action-btn",title:"删除房间（不可恢复）","data-tooltip":"删除房间"},s[35]||(s[35]=[t("i",{class:"fas fa-trash"},null,-1),t("span",{class:"btn-text"},"删除",-1)]),8,Bt)])])]))),128))])]),m.value.length===0?(f(),p("div",Kt,s[37]||(s[37]=[t("i",{class:"fas fa-bed"},null,-1),t("h3",null,"暂无房间数据",-1),t("p",null,'点击"添加房间"按钮创建第一个房间',-1)]))):C("",!0)])),m.value.length>0?(f(),p("div",Ot,[t("button",{onClick:s[3]||(s[3]=a=>z(i.current-1)),disabled:i.current<=1,class:"btn btn-secondary"},s[38]||(s[38]=[t("i",{class:"fas fa-chevron-left"},null,-1),y(" 上一页 ")]),8,Ht),t("span",At," 第 "+n(i.current)+" 页，共 "+n(i.pages)+" 页 ",1),t("button",{onClick:s[4]||(s[4]=a=>z(i.current+1)),disabled:i.current>=i.pages,class:"btn btn-secondary"},s[39]||(s[39]=[y(" 下一页 "),t("i",{class:"fas fa-chevron-right"},null,-1)]),8,Gt)])):C("",!0)]),b.value||S.value?(f(),p("div",{key:0,class:"modal-overlay",onClick:w},[t("div",{class:"modal",onClick:s[16]||(s[16]=N(()=>{},["stop"]))},[t("div",It,[t("h3",null,n(b.value?"添加房间":"编辑房间"),1),t("button",{onClick:w,class:"close-btn"},s[40]||(s[40]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Pt,[t("form",{onSubmit:N(G,["prevent"]),class:"room-form"},[t("div",Wt,[t("div",Jt,[s[41]||(s[41]=t("label",{for:"name"},"房间名称 *",-1)),u(t("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>l.name=a),type:"text",id:"name",required:"",placeholder:"请输入房间名称",class:"form-input"},null,512),[[c,l.name]])]),t("div",Qt,[s[42]||(s[42]=t("label",{for:"code"},"房间号 *",-1)),u(t("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>l.code=a),type:"text",id:"code",required:"",placeholder:"请输入房间号",class:"form-input"},null,512),[[c,l.code]])])]),t("div",Xt,[t("div",Yt,[s[44]||(s[44]=t("label",{for:"category"},"房间类型 *",-1)),u(t("select",{"onUpdate:modelValue":s[7]||(s[7]=a=>l.category=a),id:"category",required:"",class:"form-input"},s[43]||(s[43]=[st('<option value="" data-v-7da94515>请选择房间类型</option><option value="豪华海景房" data-v-7da94515>豪华海景房</option><option value="普洱茶香木屋" data-v-7da94515>普洱茶香木屋</option><option value="庄园豪华套房" data-v-7da94515>庄园豪华套房</option><option value="竹林雅居" data-v-7da94515>竹林雅居</option><option value="山景别墅" data-v-7da94515>山景别墅</option>',6)]),512),[[E,l.category]])]),t("div",Zt,[s[45]||(s[45]=t("label",{for:"price"},"价格 *",-1)),u(t("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>l.price=a),type:"number",id:"price",required:"",min:"0",step:"0.01",placeholder:"请输入价格",class:"form-input"},null,512),[[c,l.price]])])]),t("div",ts,[t("div",ss,[s[46]||(s[46]=t("label",{for:"city"},"所在城市 *",-1)),u(t("input",{"onUpdate:modelValue":s[9]||(s[9]=a=>l.city=a),type:"text",id:"city",required:"",placeholder:"请输入城市",class:"form-input"},null,512),[[c,l.city]])]),t("div",es,[s[47]||(s[47]=t("label",{for:"seat"},"床位数 *",-1)),u(t("input",{"onUpdate:modelValue":s[10]||(s[10]=a=>l.seat=a),type:"number",id:"seat",required:"",min:"1",placeholder:"请输入床位数",class:"form-input"},null,512),[[c,l.seat]])])]),t("div",as,[s[48]||(s[48]=t("label",{for:"address"},"详细地址 *",-1)),u(t("input",{"onUpdate:modelValue":s[11]||(s[11]=a=>l.address=a),type:"text",id:"address",required:"",placeholder:"请输入详细地址",class:"form-input"},null,512),[[c,l.address]])]),t("div",ls,[s[49]||(s[49]=t("label",{for:"device"},"配套设施",-1)),u(t("input",{"onUpdate:modelValue":s[12]||(s[12]=a=>l.device=a),type:"text",id:"device",placeholder:"请输入配套设施，用逗号分隔",class:"form-input"},null,512),[[c,l.device]])]),t("div",ns,[s[50]||(s[50]=t("label",{for:"banner"},"封面图片URL",-1)),u(t("input",{"onUpdate:modelValue":s[13]||(s[13]=a=>l.banner=a),type:"url",id:"banner",placeholder:"请输入图片URL",class:"form-input"},null,512),[[c,l.banner]])]),t("div",os,[s[51]||(s[51]=t("label",{for:"describe"},"房间描述",-1)),u(t("textarea",{"onUpdate:modelValue":s[14]||(s[14]=a=>l.describe=a),id:"describe",rows:"4",placeholder:"请输入房间描述",class:"form-input"},null,512),[[c,l.describe]])]),t("div",is,[s[52]||(s[52]=t("label",{for:"remark"},"备注",-1)),u(t("textarea",{"onUpdate:modelValue":s[15]||(s[15]=a=>l.remark=a),id:"remark",rows:"3",placeholder:"请输入备注信息",class:"form-input"},null,512),[[c,l.remark]])]),t("div",ds,[t("button",{type:"button",onClick:w,class:"btn btn-secondary"}," 取消 "),t("button",{type:"submit",class:"btn btn-primary",disabled:h.value},[h.value?(f(),p("i",us)):C("",!0),y(" "+n(h.value?"提交中...":b.value?"添加房间":"更新房间"),1)],8,rs)])],32)])])])):C("",!0),T.value?(f(),p("div",{key:1,class:"modal-overlay",onClick:w},[t("div",{class:"modal modal-large",onClick:s[17]||(s[17]=N(()=>{},["stop"]))},[t("div",{class:"modal-header"},[s[54]||(s[54]=t("h3",null,"房间详情",-1)),t("button",{onClick:w,class:"close-btn"},s[53]||(s[53]=[t("i",{class:"fas fa-times"},null,-1)]))]),s[55]||(s[55]=t("div",{class:"modal-body"},[t("p",null,"房间详情功能开发中...")],-1))])])):C("",!0)]))}}),ms=et(cs,[["__scopeId","data-v-7da94515"]]);export{ms as default};
