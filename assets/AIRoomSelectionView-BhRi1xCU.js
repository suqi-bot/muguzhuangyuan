import{d as re,b as d,o as ce,f as n,g as l,i as e,L as Q,R as H,p as k,l as $,t as i,F as Z,k as ee,m as de,v as Ie,G as Te,H as xe,_ as ue,u as Se,a as Ce,h as le,j as X,A as Ae,s as _,M as Ue,U as j,w as We}from"./index-vYzfv9NW.js";import"./request-DzKJqaQU.js";import{r as z,i as Me,a as Ve}from"./indoor5-EE3fvsa8.js";import{useChatHistoryStore as qe}from"./chatHistory-DGVlMt2a.js";const Oe="/muguzhuangyuan/assets/indoor4-D7gg6sht.jpg",Ne={class:"dify-chat-widget"},Ee={class:"chat-container"},Le={class:"chat-header"},Pe={class:"ai-avatar-section"},ze={class:"ai-avatar-circle"},Be=["src"],Fe={class:"ai-info-section"},Ke={class:"connection-status"},je={class:"status-text"},He={key:0,class:"message-avatar"},Ye=["src"],Ge={class:"message-content"},Je=["innerHTML"],Qe={class:"message-time"},Xe={key:0,class:"message assistant typing-indicator"},Ze={class:"message-avatar"},et=["src"],tt={class:"chat-input"},st={class:"input-container"},at=["disabled"],ot=["disabled"],it=re({__name:"DifyChatWidgetNew",props:{containerId:{default:"dify-chat-container"},autoLoad:{type:Boolean,default:!0}},emits:["loaded","error","message"],setup(te,{expose:x,emit:Y}){const G=te,A=Y,f=d([]),M=d(""),b=d(!1),m=d(!1),v=d(""),p=d(null),w={apiKey:"app-iB6nMxbyCqXQPwHConOuiImb",baseUrl:"/api/dify/v1",chatUrl:"/api/dify/v1/chat-messages"},V=async()=>{try{console.log("正在连接Dify服务..."),console.log("使用API Key:",w.apiKey),console.log("Base URL:",w.baseUrl);const h=await fetch(`${w.baseUrl}/parameters`,{method:"GET",headers:{Authorization:`Bearer ${w.apiKey}`,"Content-Type":"application/json"}});if(console.log("基础连接测试状态:",h.status),h.ok){const r=await fetch(w.chatUrl,{method:"POST",headers:{Authorization:`Bearer ${w.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:{},query:"hello",response_mode:"blocking",user:"test-user"})});if(r.ok)m.value=!0,U(),A("loaded");else{const g=await r.text();throw new Error(`聊天API错误: ${r.status}`)}}else throw new Error(`基础连接失败: ${h.status}`)}catch(h){m.value=!1,A("error",`无法连接到Dify服务: ${h instanceof Error?h.message:String(h)}`),U()}},U=()=>{const h={id:Date.now(),type:"assistant",content:"您好！我是普普AI助手，您的专属选房顾问。我可以根据您的需求为您推荐最适合的房间。请告诉我您的需求，比如预算、房型偏好等。",timestamp:new Date().toISOString()};f.value.push(h),q()},B=()=>{v.value="",f.value=[],U()},W=async()=>{if(!M.value.trim()||!m.value||b.value)return;const h=M.value.trim(),r={id:Date.now(),type:"user",content:h,timestamp:new Date().toISOString()};f.value.push(r),M.value="",q(),b.value=!0;try{if(!m.value)throw new Error("Dify服务未连接");const g={inputs:{},query:h,response_mode:"blocking",user:"user-"+Date.now()};v.value&&v.value.trim()&&(g.conversation_id=v.value);const R=await fetch(w.chatUrl,{method:"POST",headers:{Authorization:`Bearer ${w.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(R.ok){const S=await R.json();S.conversation_id&&(v.value=S.conversation_id);const N={id:Date.now()+1,type:"assistant",content:S.answer||"抱歉，我没有理解您的问题，请重新描述。",timestamp:new Date().toISOString()};f.value.push(N),A("message",{type:"ai",content:N.content,timestamp:N.timestamp})}else{const S=await R.text();if(R.status===404&&S.includes("Conversation Not Exists")){console.log("会话不存在，重置会话ID并重试"),v.value="";try{const L=await fetch(w.chatUrl,{method:"POST",headers:{Authorization:`Bearer ${w.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:{},query:h,response_mode:"blocking",user:"user-"+Date.now()})});if(L.ok){const P=await L.json();console.log("重试成功，Dify响应数据:",P),P.conversation_id&&(v.value=P.conversation_id,console.log("新会话ID:",v.value));const F={id:Date.now()+1,type:"assistant",content:P.answer||"抱歉，我没有理解您的问题，请重新描述。",timestamp:new Date().toISOString()};f.value.push(F),A("message",{type:"ai",content:F.content,timestamp:F.timestamp});return}}catch(L){console.error("重试失败:",L)}}const N={id:Date.now()+1,type:"assistant",content:`抱歉，AI服务暂时不可用（错误代码：${R.status}）。请稍后再试或联系管理员。`,timestamp:new Date().toISOString()};f.value.push(N)}}catch(g){console.error("发送消息失败:",g);const R={id:Date.now()+1,type:"assistant",content:`抱歉，发送消息时出现错误：${g instanceof Error?g.message:String(g)}。请检查网络连接或稍后再试。`,timestamp:new Date().toISOString()};f.value.push(R)}finally{b.value=!1,q()}},q=()=>{xe(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},E=h=>new Date(h).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),O=h=>{if(!h)return"";console.log("原始消息内容:",h);let r=h;return r=r.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(g,R,S)=>(console.log(`Markdown链接转换: "${R}" → "${S}"`),`<a href="${S}" target="_blank" rel="noopener noreferrer" class="message-link">${R}</a>`)),r=r.replace(/\n/g,"<br>"),console.log("最终格式化内容:",r),r};return ce(()=>{G.autoLoad&&setTimeout(()=>{V()},1e3)}),x({initializeDify:V,isDifyConnected:()=>m.value,sendMessage:W}),(h,r)=>(l(),n("div",Ne,[e("div",Ee,[e("div",Le,[e("div",Pe,[e("div",ze,[e("video",{src:Q(H),alt:"普普AI助手",class:"ai-character-video",autoplay:"",loop:"",muted:"",playsinline:""},null,8,Be),e("div",{class:k(["status-indicator",{online:m.value}])},null,2)]),e("div",Fe,[r[1]||(r[1]=e("h3",{class:"ai-name"},"普普 AI助手",-1)),r[2]||(r[2]=e("p",{class:"ai-title"},"专属选房顾问",-1)),e("div",Ke,[e("span",{class:k(["status-dot",{online:m.value}])},null,2),e("span",je,i(m.value?"在线":"连接中..."),1),m.value?$("",!0):(l(),n("button",{key:0,onClick:V,class:"reconnect-btn"}," 重新连接 ")),m.value&&v.value?(l(),n("button",{key:1,onClick:B,class:"reset-btn"}," 新对话 ")):$("",!0)])])])]),e("div",{class:"chat-messages",ref_key:"chatMessages",ref:p},[(l(!0),n(Z,null,ee(f.value,g=>(l(),n("div",{key:g.id,class:k(["message",g.type])},[g.type==="assistant"?(l(),n("div",He,[e("video",{src:Q(H),class:"avatar-video",autoplay:"",loop:"",muted:"",playsinline:""},null,8,Ye)])):$("",!0),e("div",Ge,[e("div",{class:"message-text",innerHTML:O(g.content)},null,8,Je),e("div",Qe,i(E(g.timestamp)),1)])],2))),128)),b.value?(l(),n("div",Xe,[e("div",Ze,[e("video",{src:Q(H),class:"avatar-video",autoplay:"",loop:"",muted:"",playsinline:""},null,8,et)]),r[3]||(r[3]=e("div",{class:"message-content"},[e("div",{class:"typing-dots"},[e("span"),e("span"),e("span")])],-1))])):$("",!0)],512),e("div",tt,[e("div",st,[de(e("input",{"onUpdate:modelValue":r[0]||(r[0]=g=>M.value=g),onKeypress:Te(W,["enter"]),placeholder:"请输入您的需求，比如：推荐便宜的房间...",class:"message-input",disabled:!m.value||b.value},null,40,at),[[Ie,M.value]]),e("button",{onClick:W,class:"send-button",disabled:!M.value.trim()||!m.value||b.value},r[4]||(r[4]=[e("i",{class:"fas fa-paper-plane"},null,-1)]),8,ot)])])])]))}}),nt=ue(it,[["__scopeId","data-v-f7b16ef6"]]),lt={class:"ai-room-selection"},rt={class:"main-content"},ct={class:"container"},dt={class:"content-grid"},ut={class:"left-panel"},pt={class:"ai-assistant"},ht={class:"ai-header"},ft={class:"ai-avatar"},mt=["src"],vt={key:0,class:"speaking-indicator"},gt={class:"ai-info"},bt={class:"ai-status"},wt={class:"ai-controls"},yt={class:"control-buttons"},_t=["disabled"],kt={key:0,class:"fas fa-microphone"},Dt={key:1,class:"fas fa-stop"},$t=["disabled"],Rt={key:0,class:"voice-indicator"},It={key:1,class:"voice-result"},Tt={class:"voice-content"},xt={key:0,class:"count"},St={class:"rooms-list"},Ct={key:0,class:"empty-state"},At={key:1,class:"rooms-container"},Ut={class:"recommendations-header"},Wt={class:"recommendations-count"},Mt=["onClick"],Vt=["src","alt"],qt={class:"room-info"},Ot={key:0,class:"recommend-reason"},Nt={class:"room-meta"},Et={class:"price"},Lt={class:"rating"},Pt={class:"order-details"},zt={key:0,class:"order-status"},Bt={class:"order-content"},Ft={key:0,class:"order-info"},Kt={class:"order-header"},jt={class:"order-number"},Ht={class:"value"},Yt={class:"order-date"},Gt={class:"value"},Jt={class:"order-room-info"},Qt={class:"room-image-container"},Xt=["src"],Zt={class:"room-details"},es={class:"stay-dates"},ts={class:"date-item"},ss={class:"date-item"},as={class:"guest-info"},os={class:"guest-item"},is={class:"value"},ns={class:"guest-item"},ls={class:"value"},rs={class:"order-summary"},cs={class:"summary-item"},ds={class:"value"},us={class:"summary-item total"},ps={class:"value price"},hs={key:1,class:"empty-state"},fs={class:"right-panel"},ms={class:"chat-container"},vs={class:"chat-header"},gs={class:"chat-status"},bs={class:"dify-chat-wrapper"},ws={class:"all-rooms-section"},ys={class:"section-header"},_s={class:"room-filters"},ks={class:"view-toggle"},Ds={class:"rooms-content"},$s={key:0,class:"loading-state"},Rs={key:1,class:"empty-state"},Is=["onClick"],Ts={class:"room-image-container"},xs=["src","alt"],Ss={class:"room-price-badge"},Cs={class:"room-details"},As={class:"room-header"},Us={class:"room-name"},Ws={key:0,class:"room-rating"},Ms={class:"room-type"},Vs={class:"room-features"},qs={key:0,class:"feature"},Os={class:"feature"},Ns={key:1,class:"feature"},Es=["href","onClick"],Ls={class:"room-footer"},Ps={class:"room-category"},zs=["disabled","onClick"],Bs=re({__name:"AIRoomSelectionView",setup(te){Se(),Ce(),qe();const x=d(!1),Y=d(!1),G=d("idle"),A=d(H),f=d([]);d(0);const M=d(),b=d(!1),m=d(""),v=d(null),p=d(null);d([]);const w=[{id:"107",code:"107",name:"雨林景观豪华蘑菇屋（单人间）",price:456,rating:4.8,status:"available",image:j,floor:"1楼",direction:"南向带阳台",type:"单人间",features:["南向阳台","茶园景观"]},{id:"108",code:"108",name:"1楼茶园房",price:156,rating:4.6,status:"available",image:j,floor:"1楼",direction:"南向阳光",type:"单人间",features:["性价比之选","茶园景观"]},{id:"201",code:"201",name:"雨林景观豪华蘑菇屋（单人间）",price:268,rating:4.7,status:"available",image:z,floor:"2楼",direction:"南向带阳台",type:"单人间",features:["南向阳台","雨林景观"]},{id:"202",code:"202",name:"雨林景观豪华蘑菇屋",price:486,rating:4.9,status:"available",image:z,floor:"2楼",direction:"南向采光",type:"双人间",features:["含双早","茶园景观"]},{id:"204",code:"204",name:"山景阳台南向房",price:999,rating:4.9,status:"available",image:z,floor:"2楼",direction:"南向阳台",type:"双人间",features:["含双早","特色山景阳台","雨林景观"]},{id:"206",code:"206",name:"雨林景观豪华蘑菇屋",price:654,rating:4.8,status:"available",image:z,floor:"2楼",direction:"西向观景",type:"双人间",features:["含双早","配茶具套装"]},{id:"207",code:"207",name:"雨林景观豪华蘑菇屋（双人间）",price:186,rating:4.7,status:"available",image:z,floor:"2楼",direction:"东向带阳台",type:"双人间",features:["东向阳台","雨林景观"]},{id:"208",code:"208",name:"茶园景观北向房",price:198,rating:4.6,status:"available",image:z,floor:"2楼",direction:"北向",type:"单人间",features:["山景阳台","早餐","茶园景观"]},{id:"301",code:"301",name:"雨林景观豪华蘑菇屋（双人间）",price:486,rating:4.8,status:"available",image:Me,floor:"3楼",direction:"南向",type:"双人间",features:["茶具套装","含早餐","茶园景观"]},{id:"302",code:"302",name:"雨林景观豪华蘑菇屋（双人间）",price:688,rating:4.8,status:"available",image:Oe,floor:"3楼",direction:"南向",type:"双人间",features:["茶园景观","雨林景观"]},{id:"303",code:"303",name:"雨林景观豪华蘑菇屋（亲子房）",price:1088,rating:4.9,status:"available",image:Ve,floor:"3楼",direction:"南向",type:"亲子房",features:["山景阳台","含早餐","适合家庭"]}],V=d(),U=d(),B=d([]),W=d([]),q=d(!1),E=d("all"),O=d("grid"),h=()=>{console.log("AI视频开始加载:",A.value)},r=()=>{console.log("AI视频加载完成"),V.value&&V.value.play().catch(s=>{console.error("AI视频播放失败:",s)})},g=s=>{console.error("AI视频加载错误:",s),console.error("视频源:",A.value)};ce(()=>{R(),S(),se(),console.log("当前视频源:",A.value)});const R=()=>{console.log("AI助手初始化完成，使用Dify组件")},S=async()=>{await N()},N=async()=>{q.value=!0;try{const s=[{id:1,code:"展览厅",name:"展览厅",category:"展览厅",floor:"1楼",height:"2438",hasWindow:!1,windowDirection:"无",roomType:"展览厅",price:0,seat:0,rating:0,status:"unavailable",image:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop",vrUrl:"",recommendReason:"展览厅暂不开放预订"},{id:2,code:"105",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"1楼",height:"2438",hasWindow:!1,windowDirection:"无",roomType:"单人间",price:256,seat:1,rating:4.5,status:"available",image:"https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"雨林景观，环境优美，适合独自旅行"},{id:3,code:"104",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"1楼",height:"2438",hasWindow:!1,windowDirection:"无",roomType:"单人间",price:255,seat:1,rating:4.5,status:"available",image:"https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"性价比高，环境舒适"},{id:4,code:"103",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"1楼",height:"2438",hasWindow:!1,windowDirection:"无",roomType:"单人间",price:333,seat:1,rating:4.6,status:"available",image:"https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"高评分房间，服务优质"},{id:5,code:"102",name:"雨林景观豪华蘑菇屋",category:"大床房",floor:"1楼",height:"2438",hasWindow:!0,windowDirection:"东",roomType:"大床房",price:888,seat:2,rating:4.8,status:"available",image:"https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"豪华大床房，带窗户，视野开阔"},{id:6,code:"106",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"1楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"单人间",price:666,seat:1,rating:4.7,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"南向房间，采光充足，环境优雅"},{id:7,code:"107",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"1楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"单人间",price:456,seat:1,rating:4.6,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"中等价位，性价比不错"},{id:8,code:"108",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"1楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"单人间",price:156,seat:1,rating:4.4,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"经济实惠，适合预算有限的客人"},{id:9,code:"101",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"1楼",height:"2438",hasWindow:!0,windowDirection:"东",roomType:"单人间",price:18,seat:1,rating:4.2,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"超值特价房，性价比极高"},{id:10,code:"211",name:"雨林景观豪华蘑菇屋",category:"亲子房",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"西",roomType:"亲子房",price:419,seat:3,rating:4.7,status:"available",image:"https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:"亲子房，适合家庭出行，空间宽敞"},{id:11,code:"212",name:"雨林景观豪华蘑菇屋",category:"亲子房",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"西",roomType:"亲子房",price:418,seat:3,rating:4.7,status:"available",image:"https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:12,code:"210",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"北",roomType:"单人间",price:189,seat:1,rating:4.4,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:13,code:"209",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"北",roomType:"单人间",price:418,seat:1,rating:4.6,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:14,code:"208",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"北",roomType:"单人间",price:18,seat:1,rating:4.2,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:15,code:"207",name:"雨林景观豪华蘑菇屋",category:"大床房",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"东",roomType:"大床房",price:186,seat:2,rating:4.5,status:"available",image:"https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:16,code:"206",name:"雨林景观豪华蘑菇屋",category:"双人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"西",roomType:"双人间",price:654,seat:2,rating:4.7,status:"available",image:"https://images.unsplash.com/photo-1618773928121-c32242e63f39?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:17,code:"205",name:"雨林景观豪华蘑菇屋",category:"双人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"东",roomType:"双人间",price:789,seat:2,rating:4.8,status:"available",image:"https://images.unsplash.com/photo-1618773928121-c32242e63f39?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:18,code:"204",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"单人间",price:999,seat:1,rating:4.9,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:19,code:"203",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"单人间",price:889,seat:1,rating:4.8,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:20,code:"202",name:"雨林景观豪华蘑菇屋",category:"单人间",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"单人间",price:48,seat:1,rating:4.3,status:"available",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:21,code:"201",name:"雨林景观豪华蘑菇屋",category:"大床房",floor:"2楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"大床房",price:19,seat:2,rating:4.1,status:"available",image:"https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:22,code:"301",name:"雨林景观豪华蘑菇屋",category:"亲子房",floor:"3楼",height:"2438",hasWindow:!1,windowDirection:"无",roomType:"亲子房",price:486,seat:4,rating:4.8,status:"available",image:"https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:23,code:"302",name:"雨林景观豪华蘑菇屋",category:"亲子房",floor:"3楼",height:"2438",hasWindow:!1,windowDirection:"无",roomType:"亲子房",price:1088,seat:4,rating:4.9,status:"available",image:"https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"},{id:24,code:"303",name:"雨林景观豪华蘑菇屋",category:"双人间",floor:"3楼",height:"2438",hasWindow:!0,windowDirection:"南",roomType:"双人间",price:0,seat:2,rating:4.6,status:"unavailable",image:"https://images.unsplash.com/photo-1618773928121-c32242e63f39?w=400&h=300&fit=crop",vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00"}];B.value=s,W.value=s}catch(s){console.error("加载房间数据失败:",s)}finally{q.value=!1}},L=()=>{E.value==="all"?W.value=B.value.filter(s=>s.code!=="展览厅"):W.value=B.value.filter(s=>{if(s.code==="展览厅")return!1;switch(E.value){case"single":return s.roomType==="单人间";case"double":return s.roomType==="双人间"||s.roomType==="大床房";case"family":return s.roomType==="亲子房";case"suite":return s.category.includes("套房")||s.category.includes("豪华");default:return!0}})},P=()=>{x.value=!0},F=s=>{x.value=!1},J=s=>{if(console.log("选择房间:",s),s.vrUrl&&s.vrUrl.trim()!=="")console.log("跳转到VR链接:",s.vrUrl),window.open(s.vrUrl,"_blank");else{const t="https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00";console.log("使用默认VR链接:",t),window.open(t,"_blank")}},pe=()=>{console.log("清除所有推荐房间"),f.value=[]};d("我会根据您的需求为您推荐最适合的房间");const se=()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const s=window.webkitSpeechRecognition||window.SpeechRecognition;v.value=new s,v.value.continuous=!1,v.value.interimResults=!1,v.value.lang="zh-CN",v.value.onresult=t=>{const a=t.results[0][0].transcript;m.value=a,b.value=!1},v.value.onerror=t=>{console.error("语音识别错误:",t.error),b.value=!1},v.value.onend=()=>{b.value=!1}}},he=()=>{v.value||se(),b.value?(v.value.stop(),b.value=!1):(m.value="",v.value.start(),b.value=!0)},fe=()=>{m.value&&U.value&&(U.value.sendMessage(m.value),m.value="")},me=()=>{m.value=""},ve=()=>{U.value&&U.value.resetConversation(),f.value=[],p.value=null},ge=s=>{const t=[];return console.log("🔍 解析房间推荐，消息内容:",s),[/(\d{3})号?房/g,/房间号[：:]\s*(\d{3})/g,/房间\s*(\d{3})/g,/(\d{3})\s*房间/g,/推荐.*?(\d{3})号?房/g,/建议.*?(\d{3})号?房/g,/适合.*?(\d{3})号?房/g].forEach(I=>{const u=s.match(I);u&&u.forEach(T=>{const y=T.match(/\d{3}/)?.[0];if(y){if(t.find(c=>c.code===y))return;const D=w.find(c=>c.code===y);if(D)t.push({...D,recommendReason:oe(s,y)});else{const c=be(y,s);t.push(c)}}})}),t},be=(s,t)=>{const a=ae(t,s);return{id:`template-${s}`,code:s,name:a.name||`${s}号房`,price:a.price||0,rating:4.5,status:"available",image:j,floor:a.floor||"未知楼层",direction:a.direction||"朝向未知",type:a.type||"标准间",category:a.category||"标准房",features:a.features||["基础设施"],vrUrl:"https://share-xt.hwbim.com/qlh/ffd333620ebb4e83b50899653b516f00",recommendReason:oe(t,s)}},ae=(s,t)=>{const a={},I=[new RegExp(`${t}.*?(\\d+)元`,"i"),new RegExp(`${t}.*?¥(\\d+)`,"i"),new RegExp("价格.*?(\\d+)","i"),new RegExp("总费用.*?¥(\\d+)","i"),new RegExp("总计.*?(\\d+)","i"),new RegExp("¥(\\d+)","i"),new RegExp("(\\d+)元","i")];for(const c of I){const o=s.match(c);if(o&&o[1]){a.price=parseInt(o[1]);break}}const u=[/单人间|双人间|大床房|标准间|豪华房|套房|亲子房|海景房|山景房|商务房/i,/蘑菇屋|景观房|阳台房|花园房|湖景房|森林房/i];for(const c of u){const o=s.match(c);if(o){a.type=o[0],s.includes(t)?a.name=`${t}号${o[0]}`:a.name=`${t}号房`;break}}if(!a.type){const c=s.match(new RegExp(`${t}[^，。！？]*`,"i"));c&&(a.name=c[0]||`${t}号房`)}const T=s.match(/(\d+)楼/i);T&&(a.floor=`${T[1]}楼`);const y=s.match(/(南向|北向|东向|西向|朝南|朝北|朝东|朝西)/i);y&&(a.direction=y[1]);const D=[];return s.includes("阳台")&&D.push("阳台"),(s.includes("景观")||s.includes("景色")||s.includes("海景")||s.includes("山景"))&&D.push("景观房"),s.includes("早餐")&&D.push("含早餐"),(s.includes("WiFi")||s.includes("wifi"))&&D.push("免费WiFi"),s.includes("空调")&&D.push("空调"),s.includes("电视")&&D.push("电视"),D.length>0&&(a.features=D),a},oe=(s,t)=>{const a=[new RegExp(`${t}.*?因为(.{10,50})`,"i"),new RegExp(`推荐${t}.*?(.{10,50})`,"i"),new RegExp(`${t}.*?适合(.{10,50})`,"i")];for(const I of a){const u=s.match(I);if(u&&u[1])return u[1].trim()}return"根据您的需求推荐"},we=s=>{const t={},a=[/(\d{3})号?房/,/房间号[：:]\s*(\d{3})/,/房间\s*(\d{3})/,/(\d{3})\s*房间/,/预订.*?(\d{3})/,/选择.*?(\d{3})/];for(const c of a){const o=s.match(c);if(o){t.roomCode=o[1];const C=w.find(K=>K.code===o[1]);if(C)t.roomName=C.name,t.price=C.price;else{const K=ae(s,o[1]);t.roomName=K.name||`${o[1]}号房`,t.price=K.price||0}break}}const I=[/(\d{4})年(\d{1,2})月(\d{1,2})日/,/(\d{4})-(\d{1,2})-(\d{1,2})/,/(\d{1,2})月(\d{1,2})日/,/入住.*?(\d{4})年(\d{1,2})月(\d{1,2})日/,/入住.*?(\d{4})-(\d{1,2})-(\d{1,2})/,/入住时间.*?(\d{1,2})月(\d{1,2})日/,/(\d{1,2})\/(\d{1,2})\/(\d{4})/,/7月(\d{1,2})日/,/(\d{1,2})月(\d{1,2})号/];for(const c of I){const o=s.match(c);if(o){if(o.length===4)t.checkInDate=`${o[1]}-${o[2].padStart(2,"0")}-${o[3].padStart(2,"0")}`;else if(o.length===3){const C=new Date().getFullYear();t.checkInDate=`${C}-${o[1].padStart(2,"0")}-${o[2].padStart(2,"0")}`}else if(c.source.includes("7月")){const C=new Date().getFullYear();t.checkInDate=`${C}-07-${o[1].padStart(2,"0")}`}break}}const u=[/退房.*?(\d{1,2})月(\d{1,2})日/,/退房时间.*?(\d{1,2})月(\d{1,2})日/,/7月(\d{1,2})日.*?退房/,/退房.*?7月(\d{1,2})日/];for(const c of u){const o=s.match(c);if(o){const C=new Date().getFullYear();c.source.includes("7月")?t.checkOutDate=`${C}-07-${o[1].padStart(2,"0")}`:t.checkOutDate=`${C}-${o[1].padStart(2,"0")}-${o[2].padStart(2,"0")}`;break}}const T=[/1[3-9]\d{9}/,/手机[：:]\s*(1[3-9]\d{9})/,/电话[：:]\s*(1[3-9]\d{9})/,/联系方式[：:]\s*(1[3-9]\d{9})/];for(const c of T){const o=s.match(c);if(o){t.phone=o[1]||o[0];break}}const y=[/(\d+)元/,/总计[：:]\s*(\d+)/,/费用[：:]\s*(\d+)/,/价格[：:]\s*(\d+)/,/¥(\d+)/];for(const c of y){const o=s.match(c);if(o){t.totalAmount=parseInt(o[1]);break}}const D=[/姓名[：:]\s*([^\s\d]{2,4})/,/客人[：:]\s*([^\s\d]{2,4})/,/预订人[：:]\s*([^\s\d]{2,4})/];for(const c of D){const o=s.match(c);if(o){t.guestName=o[1];break}}return console.log("📊 解析订单结果:",t),t},ye=s=>{if(console.log("收到Dify消息:",s),s.type==="ai"&&s.content){const t=ge(s.content);if(t.length>0){const u=f.value.map(y=>y.code),T=t.filter(y=>!u.includes(y.code));T.length>0?(f.value=[...f.value,...T],console.log("添加新推荐房间:",T),console.log("当前所有推荐房间:",f.value)):console.log("没有新的推荐房间，所有房间都已存在")}if(["预订成功","订单详情","预订确认","订单确认","预订完成","已预订","预订信息","订单生成","确认预订","预订单","订单创建","预订记录"].some(u=>s.content.includes(u))){const u=we(s.content);if(u.roomCode){const T={orderNumber:"ORD"+Date.now(),roomCode:u.roomCode,roomName:u.roomName||"雨林景观豪华蘑菇屋",checkInDate:u.checkInDate||ie(),checkOutDate:ke(u.checkInDate||ie()),totalAmount:u.totalAmount||u.price||48,phone:u.phone||"待补充",guestName:u.guestName||"待补充",status:"confirmed",createdAt:new Date().toISOString()};p.value=T}}}},_e=s=>{if(console.log("点击VR链接:",s),!s||s.trim()===""){console.error("VR链接为空"),alert("VR链接无效，请联系客服");return}if(!s.startsWith("http://")&&!s.startsWith("https://")){console.error("VR链接格式无效:",s),alert("VR链接格式无效，请联系客服");return}console.log("正在打开VR链接:",s)},ie=()=>{const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]},ke=s=>{const t=new Date(s);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]},De=s=>w.find(a=>a.code===s)?.image||j,ne=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),$e=()=>{p.value&&(p.value=null)},Re=()=>{p.value};return(s,t)=>(l(),n("div",lt,[le(Ae),t[46]||(t[46]=X('<div class="page-header" data-v-d3dd870c><div class="container" data-v-d3dd870c><h1 class="page-title" data-v-d3dd870c><span class="ai-icon" data-v-d3dd870c>🌳</span> AI智能选房 </h1><p class="page-subtitle" data-v-d3dd870c>与普普AI助手对话，找到最适合您的房间</p></div></div>',1)),e("div",rt,[e("div",ct,[e("div",dt,[e("div",ut,[e("div",pt,[e("div",ht,[e("div",ft,[e("video",{ref_key:"aiVideo",ref:V,src:A.value,alt:"普普AI助手",class:k(["ai-character",G.value]),autoplay:"",loop:"",muted:"",playsinline:"",onLoadstart:h,onLoadeddata:r,onError:g},null,42,mt),Y.value?(l(),n("div",vt,t[3]||(t[3]=[e("div",{class:"wave"},null,-1),e("div",{class:"wave"},null,-1),e("div",{class:"wave"},null,-1)]))):$("",!0)]),e("div",gt,[t[4]||(t[4]=e("h3",null,"普普 AI助手",-1)),t[5]||(t[5]=e("p",null,"专属选房顾问",-1)),e("div",bt,[e("span",{class:k(["status-dot",{online:x.value}])},null,2),e("span",null,i(x.value?"在线":"离线"),1)])])]),e("div",wt,[e("div",yt,[e("button",{class:k(["control-btn voice-btn",{active:b.value}]),onClick:he,disabled:!x.value},[b.value?(l(),n("i",Dt)):(l(),n("i",kt)),e("span",null,i(b.value?"停止录音":"语音输入"),1)],10,_t),e("button",{class:"control-btn reset-btn",onClick:ve,disabled:!x.value},t[6]||(t[6]=[e("i",{class:"fas fa-redo-alt"},null,-1),e("span",null,"重置对话",-1)]),8,$t)]),b.value?(l(),n("div",Rt,t[7]||(t[7]=[X('<div class="voice-wave" data-v-d3dd870c><div class="wave-bar" data-v-d3dd870c></div><div class="wave-bar" data-v-d3dd870c></div><div class="wave-bar" data-v-d3dd870c></div><div class="wave-bar" data-v-d3dd870c></div><div class="wave-bar" data-v-d3dd870c></div></div><p class="voice-text" data-v-d3dd870c>正在聆听您的语音...</p>',2)]))):$("",!0),m.value?(l(),n("div",It,[t[10]||(t[10]=e("p",{class:"voice-label"},"识别结果：",-1)),e("p",Tt,i(m.value),1),e("div",{class:"voice-actions"},[e("button",{class:"send-voice-btn",onClick:fe},t[8]||(t[8]=[e("i",{class:"fas fa-paper-plane"},null,-1),_(" 发送 ")])),e("button",{class:"clear-voice-btn",onClick:me},t[9]||(t[9]=[e("i",{class:"fas fa-times"},null,-1),_(" 清除 ")]))])])):$("",!0)])]),e("div",{class:k(["recommended-rooms",{"has-content":f.value.length>0}])},[e("h3",null,[t[11]||(t[11]=e("i",{class:"fas fa-star"},null,-1)),t[12]||(t[12]=_(" AI推荐房间 ")),f.value.length>0?(l(),n("span",xt,"("+i(f.value.length)+")",1)):$("",!0)]),e("div",St,[f.value.length===0?(l(),n("div",Ct,t[13]||(t[13]=[e("i",{class:"fas fa-robot"},null,-1),e("p",null,"请与AI助手对话，我会为您推荐最适合的房间",-1),e("p",{class:"empty-hint"},"例如：我想要一个便宜的房间、推荐豪华房间、适合家庭的房间",-1)]))):(l(),n("div",At,[e("div",Ut,[e("span",Wt,i(f.value.length)+"个推荐房间",1),e("button",{class:"clear-recommendations",onClick:pe,title:"清除推荐"},t[14]||(t[14]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",{class:"rooms-scroll",ref_key:"roomsScrollContainer",ref:M},[(l(!0),n(Z,null,ee(f.value,a=>(l(),n("div",{key:a.id,class:"room-card recommended",onClick:I=>J(a)},[t[16]||(t[16]=e("div",{class:"recommend-badge"},[e("i",{class:"fas fa-robot"}),_(" AI推荐 ")],-1)),e("img",{src:a.image,alt:a.name,class:"room-image"},null,8,Vt),e("div",qt,[e("h4",null,i(a.code)+"号房",1),e("p",null,i(a.name),1),a.recommendReason?(l(),n("div",Ot,[t[15]||(t[15]=e("i",{class:"fas fa-lightbulb"},null,-1)),_(" "+i(a.recommendReason),1)])):$("",!0),e("div",Nt,[e("span",Et,"¥"+i(a.price)+"/晚",1),e("span",Lt,"⭐"+i(a.rating),1),e("span",{class:k(["status",a.status])},i(a.status==="available"?"可预订":"已预订"),3)])])],8,Mt))),128))],512)]))])],2),e("div",Pt,[e("h3",null,[t[17]||(t[17]=e("i",{class:"fas fa-receipt"},null,-1)),t[18]||(t[18]=_(" 订单详情 ")),p.value?(l(),n("span",zt,"已确认")):$("",!0)]),e("div",Bt,[p.value?(l(),n("div",Ft,[e("div",Kt,[e("div",jt,[t[19]||(t[19]=e("span",{class:"label"},"订单号",-1)),e("span",Ht,i(p.value.orderNumber),1)]),e("div",Yt,[t[20]||(t[20]=e("span",{class:"label"},"创建时间",-1)),e("span",Gt,i(new Date(p.value.createdAt).toLocaleString()),1)])]),e("div",Jt,[e("div",Qt,[e("img",{src:De(p.value.roomCode),alt:"房间图片",class:"room-thumbnail"},null,8,Xt)]),e("div",Zt,[e("h4",null,i(p.value.roomCode)+"号房 - "+i(p.value.roomName),1),e("div",es,[e("div",ts,[t[21]||(t[21]=e("i",{class:"fas fa-calendar-check"},null,-1)),e("span",null,"入住: "+i(ne(p.value.checkInDate)),1)]),e("div",ss,[t[22]||(t[22]=e("i",{class:"fas fa-calendar-times"},null,-1)),e("span",null,"退房: "+i(ne(p.value.checkOutDate)),1)])])])]),e("div",as,[e("div",os,[t[23]||(t[23]=e("i",{class:"fas fa-user"},null,-1)),t[24]||(t[24]=e("span",{class:"label"},"客人:",-1)),e("span",is,i(p.value.guestName||"待补充"),1)]),e("div",ns,[t[25]||(t[25]=e("i",{class:"fas fa-phone"},null,-1)),t[26]||(t[26]=e("span",{class:"label"},"电话:",-1)),e("span",ls,i(p.value.phone||"待补充"),1)])]),e("div",rs,[e("div",cs,[t[27]||(t[27]=e("span",{class:"label"},"房费",-1)),e("span",ds,"¥"+i(p.value.totalAmount),1)]),t[29]||(t[29]=e("div",{class:"summary-item"},[e("span",{class:"label"},"服务费"),e("span",{class:"value"},"¥0")],-1)),e("div",us,[t[28]||(t[28]=e("span",{class:"label"},"总计",-1)),e("span",ps,"¥"+i(p.value.totalAmount),1)])]),e("div",{class:"order-actions"},[e("button",{class:"btn btn-outline",onClick:$e},t[30]||(t[30]=[e("i",{class:"fas fa-times"},null,-1),_(" 取消订单 ")])),e("button",{class:"btn btn-primary",onClick:Re},t[31]||(t[31]=[e("i",{class:"fas fa-edit"},null,-1),_(" 修改订单 ")]))])])):(l(),n("div",hs,t[32]||(t[32]=[e("i",{class:"fas fa-clipboard-list"},null,-1),e("p",null,"暂无订单信息",-1),e("p",{class:"empty-hint"},"与AI助手对话，创建订单后将显示在这里",-1),e("p",{class:"empty-hint"},"例如：我想预订101号房间",-1)])))])])]),e("div",fs,[e("div",ms,[e("div",vs,[t[33]||(t[33]=e("h3",null,[e("i",{class:"fas fa-comments"}),_(" 与AI助手对话 ")],-1)),e("div",gs,[e("span",{class:k(["status-dot",{online:x.value}])},null,2),e("span",null,i(x.value?"在线":"离线"),1)])]),e("div",bs,[le(nt,{ref_key:"difyChatWidget",ref:U,"container-id":"ai-room-dify-container","auto-load":!0,onLoaded:P,onError:F,onMessage:ye},null,512)])])])]),e("div",ws,[e("div",ys,[t[37]||(t[37]=e("h2",null,[e("i",{class:"fas fa-home"}),_(" 全部房间 ")],-1)),e("div",_s,[de(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>E.value=a),onChange:L,class:"filter-select"},t[34]||(t[34]=[X('<option value="all" data-v-d3dd870c>全部房型</option><option value="single" data-v-d3dd870c>单人房</option><option value="double" data-v-d3dd870c>双人房</option><option value="family" data-v-d3dd870c>家庭房</option><option value="suite" data-v-d3dd870c>套房</option>',5)]),544),[[Ue,E.value]]),e("div",ks,[e("button",{class:k(["toggle-btn",{active:O.value==="grid"}]),onClick:t[1]||(t[1]=a=>O.value="grid")},t[35]||(t[35]=[e("i",{class:"fas fa-th"},null,-1)]),2),e("button",{class:k(["toggle-btn",{active:O.value==="list"}]),onClick:t[2]||(t[2]=a=>O.value="list")},t[36]||(t[36]=[e("i",{class:"fas fa-list"},null,-1)]),2)])])]),e("div",Ds,[q.value?(l(),n("div",$s,t[38]||(t[38]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在加载房间信息...",-1)]))):W.value.length===0?(l(),n("div",Rs,t[39]||(t[39]=[e("i",{class:"fas fa-home"},null,-1),e("p",null,"暂无符合条件的房间",-1)]))):(l(),n("div",{key:2,class:k(["rooms-grid",O.value])},[(l(!0),n(Z,null,ee(W.value,a=>(l(),n("div",{key:a.id,class:"room-item",onClick:I=>J(a)},[e("div",Ts,[e("img",{src:a.image,alt:a.name,class:"room-image"},null,8,xs),e("div",{class:k(["room-status-badge",a.status])},i(a.status==="available"?"可预订":"已预订"),3),e("div",Ss,i(a.price>0?`¥${a.price}/晚`:"价格待定"),1)]),e("div",Cs,[e("div",As,[e("h4",Us,i(a.code)+"号房 - "+i(a.roomType),1),a.rating>0?(l(),n("div",Ws,[t[40]||(t[40]=e("i",{class:"fas fa-star"},null,-1)),e("span",null,i(a.rating),1)])):$("",!0)]),e("p",Ms,i(a.name)+" ("+i(a.floor)+")",1),e("div",Vs,[a.seat>0?(l(),n("span",qs,[t[41]||(t[41]=e("i",{class:"fas fa-users"},null,-1)),_(" "+i(a.seat)+"人 ",1)])):$("",!0),e("span",Os,[t[42]||(t[42]=e("i",{class:"fas fa-window-maximize"},null,-1)),_(" "+i(a.hasWindow?`${a.windowDirection}向`:"无窗"),1)]),t[44]||(t[44]=e("span",{class:"feature"},[e("i",{class:"fas fa-wifi"}),_(" 免费WiFi ")],-1)),t[45]||(t[45]=e("span",{class:"feature"},[e("i",{class:"fas fa-snowflake"}),_(" 空调 ")],-1)),a.vrUrl?(l(),n("span",Ns,[t[43]||(t[43]=e("i",{class:"fas fa-vr-cardboard"},null,-1)),e("a",{href:a.vrUrl,target:"_blank",class:"vr-link",onClick:I=>_e(a.vrUrl)},"VR看房",8,Es)])):$("",!0)]),e("div",Ls,[e("div",Ps,i(a.category),1),e("button",{class:k(["book-btn",{disabled:a.status!=="available"||a.price===0}]),disabled:a.status!=="available"||a.price===0,onClick:We(I=>J(a),["stop"])},i(a.price===0?"价格待定":a.status==="available"?"选择房间":"已预订"),11,zs)])])],8,Is))),128))],2))])])])])]))}}),Ys=ue(Bs,[["__scopeId","data-v-d3dd870c"]]);export{Ys as default};
